var Mn=Object.defineProperty;var o=(t,e)=>Mn(t,"name",{value:e,configurable:!0});import"reflect-metadata";import{getOffsetWithDefault as bo,offsetToCursor as hn}from"graphql-relay";var Po=o(async({count:t,getMany:e,input:r={},pagination:n={}})=>{let{after:i,before:p,first:l,last:m}=n,u=bo(p,t),c=bo(i,-1),M=Math.max(-1,c)+1,_=Math.min(u,t);l&&(_=Math.min(_,M+l)),m&&(M=Math.max(M,_-m));let b=Math.max(M,0),P=Math.max(_-M,1),{result:g,root:z}=await e({...r,options:{skip:b,take:P}});if(g&&g.length){let W=g.map((le,qt)=>({cursor:hn(M+qt),node:le})),{0:ie,length:F,[F-1]:S}=W,x=i?c+1:0,ae=p?Math.min(u,t):t,Re={endCursor:S.cursor,hasNextPage:l?_<ae:!1,hasPreviousPage:m?M>x:!1,startCursor:ie.cursor};return{result:{edges:W,pageInfo:Re},root:z}}return{result:{edges:[],pageInfo:{endCursor:"",hasNextPage:!1,hasPreviousPage:!1,startCursor:""}},root:z}},"getConnection");var rt=o(({database:t,entities:e,host:r,password:n,pool:i,type:p,username:l})=>{let m={clientUrl:r,dbName:t,debug:!1,ensureIndexes:!0,entities:e,name:p,pool:{max:i.max,min:0}};return l&&n&&(m.user=l,m.password=n),m},"_database");var Ye=o(t=>t.normalize("NFKD").replace(/(.+)([A-Z])/g,"$1-$2").toLowerCase().trim().replace(/\//g,"-").replace(/\s+/g,"-").replace(/[^(\w|?)-]+/g,"").replace(/_/g,"-").replace(/--+/g,"-").replace(/-$/g,""),"slug");import wo from"lodash/trim.js";var nt=o((...[t,e=!0])=>{let r=t.split("/").filter(Boolean).map(n=>{let i=wo(n,"/");return e&&(i=i.replace(/\w\S*/g,Ye)),i}).join("/");return`/${wo(r,"/")}`},"trimPathname");var ee=o(({host:t="",isProtocol:e=!0,isTrim:r=!0,params:n,pathname:i,port:p})=>{let l=`${t}${p?`:${p}`:""}${i?r?nt(i):i:""}`;if(n){let m=Object.entries(n).map(([u,c])=>`${encodeURIComponent(u)}=${encodeURIComponent(c)}`).join("&");l=`${l}?${m}`}return!e&&([,l]=l.split("://")),l},"uri");var Ne={BAD_REQUEST:400,CONFLICT:409,FORBIDDEN:403,GATEWAY_TIMEOUT:504,INTERNAL_SERVER_ERROR:500,INVALID_TOKEN:498,NETWORK_CONNECT_TIMEOUT:599,OK:200,REDIRECT:302,SERVICE_UNAVAILABLE:503,UNAUTHORIZED:401};var ma=ee({host:process.env.APP_HOST,port:process.env.APP_PORT}),la=ee({host:process.env.SERVER_APP_STATIC_HOST,port:process.env.SERVER_APP_STATIC_PORT??void 0}),da=ee({host:process.env.SERVER_APP_HOST,port:process.env.SERVER_APP_PORT});var ve=class t extends Error{static{o(this,"HttpError")}constructor(e,r,n){super(),Object.setPrototypeOf(this,t.prototype),this.statusCode=e??Ne.INTERNAL_SERVER_ERROR,this.message=r??"HttpError",this.stack=n}};var it=class extends ve{static{o(this,"DuplicateError")}constructor(e){super(Ne.CONFLICT,e??"duplicate")}};var at=class extends Error{static{o(this,"UninitializedError")}constructor(e){super(`not initialized: ${e}`)}};import{ObjectId as _n}from"mongodb";var st=class extends _n{static{o(this,"_ObjectId")}constructor(e){super(e)}};var be=class extends st{static{o(this,"ObjectId")}constructor(e){super(e)}};var Oo=["owner"];var N=o(t=>t?.filter(Boolean),"filterNil");import{Collection as gn}from"@mikro-orm/core";var pt=class extends gn{static{o(this,"_Collection")}constructor(e){super(e)}delete(e){super.remove(e)}filter(e,r){return super.filter((n,i)=>e(n,i,[]))}find(e,r){return super.find((n,i)=>e(n,i,[]))}map(e,r){return super.map((n,i)=>e(n,i,[]))}push(...e){return super.add(e),super.length+1}slice(e,r){return super.slice(e,r)}};var C=class extends pt{static{o(this,"Collection")}};var So=o(t=>Array.isArray(t),"isArray");var H=o(t=>!!(So(t)||t instanceof C),"isArray");import Rn from"lodash/isEqual.js";var zt=o((t,e)=>Rn(t,e),"_isEqual");var mt=o(t=>t===""||t===null||t===void 0||zt(t,[])||!(t instanceof RegExp)&&JSON.stringify(t)==="{}","isEmpty");var Co=o(t=>t!==Object(t)||t instanceof String||t instanceof Date,"isPrimitive");import Ue from"lodash/get.js";import bn from"lodash/intersection.js";var Do=o((t,e)=>bn(N([t,typeof t,Ue(t,["constructor","name"]),Ue(t,["type","name"]),Ue(t,["name"])]),N([e,typeof e,Ue(e,["constructor","name"]),Ue(e,["type","name"]),Ue(e,["name"])])).length>0,"isTypeOf");import Pn from"lodash/toPlainObject.js";var Ao=o(t=>Pn(t),"_toPlainObject");var xo=o(t=>Ao(t),"toPlainObject");import wn from"lodash/isFunction.js";import On from"lodash/isObject.js";import Sn from"lodash/some.js";var lt=o((...[t,e,r=0])=>{if(Co(t)||Sn([...e?.primitiveTypes??[],RegExp],n=>Do(t,n)))return t;if(wn(t))return null;if(H(t))return N(t.map(n=>lt(n,e,r)));if(On(t)){let n=xo(e?.objectTransformer?.(t,r)??t);return Object.keys(n).forEach(i=>{let p=n[i];!Oo.includes(i)&&(p=lt(p,e,r+1)),e?.keyValueTransformer&&(p=e.keyValueTransformer(p,i,r)),mt(p)?delete n[i]:n[i]=p}),n}return t},"cleanObject");import Cn from"lodash/isEqual.js";import Dn from"lodash/isPlainObject.js";import vo from"lodash/isString.js";import An from"lodash/last.js";var No=o(t=>vo(t)?new be(t):t,"resolveObjectId"),Uo=o((t,e)=>{let r=t;return r?.entity&&(r=r.entity),H(r)?r.map(n=>Uo(n)):Dn(r)&&Cn(Object.keys(r),["_id"])?No(r._id):vo(r)&&An(e?.split("."))?.startsWith("_")?No(r):r},"keyValueTransformer"),j=o((...[t,e,r])=>lt(t,{...e,keyValueTransformer:Uo,primitiveTypes:[...e?.primitiveTypes??[],be]},r),"cleanObject");import{MikroORM as xn,wrap as Nn}from"@mikro-orm/mongodb";import Xt from"lodash/isString.js";import vn from"lodash/last.js";import Un from"lodash/toString.js";import{ObjectId as Io}from"mongodb";var dt=o((t,e)=>j(t?.reduce((r,n)=>{let i=n.condition??"$eq",{value:p}=n;switch(i){case"$like":{Xt(p)&&(i="$regex",p=new RegExp(p,"i"));break}}return{...r,[e?`${e}.${n.field}`:n.field]:{[i]:vn(n.field.split("."))?.startsWith("_")?H(p)?p.map(l=>Xt(l)?new Io(l):l):Xt(p)?new Io(p):p:p}}},{})??{}),"getFilter"),ut=class{constructor(e){this.getEntityManager=o(()=>{let{em:e}=this;if(e)return e.fork();throw new at("database")},"getEntityManager");this.getRepository=o(({name:e})=>{let r={clear:o(async()=>{await this.getEntityManager().getRepository(e).nativeDelete({})},"clear"),count:o(async n=>this.getEntityManager().getRepository(e).count(dt(n)),"count"),create:o(async({form:n,options:i}={})=>{try{let p=this.getEntityManager(),l=p.create(e,n);return i?.isFlush!==!1&&await p.persistAndFlush(l),{result:l}}catch(p){switch(p.code){case 11e3:throw new it(Un(e));default:throw p}}},"create"),createMany:o(async({form:n,options:i}={})=>{let p=this.getEntityManager(),l=await Promise.all(n?.map(async m=>(await r.create({form:m,options:{isFlush:!1}})).result)??[]);return i?.isFlush!==!1&&await p.persistAndFlush(l),{result:l}},"createMany"),flush:o(async()=>{await this.getEntityManager().flush()},"flush"),get:o(async({filter:n,id:i,options:p}={})=>{let l=this.getEntityManager(),m=i??dt(n);return{result:await l.findOne(e,mt(m)?{$expr:{$eq:[1,1]}}:m,p&&{populate:p.populate??void 0})??void 0}},"get"),getConnection:o(async({filter:n,pagination:i}={})=>{let{result:p}=await Po({count:await r.count(n),getMany:r.getMany,input:{filter:n},pagination:i});return{result:p??void 0}},"getConnection"),getMany:o(async({filter:n,options:i}={})=>{let p=this.getEntityManager(),l=dt(n);return{result:await p.find(e,l,i&&{limit:i.take,offset:i.skip})??void 0}},"getMany"),remove:o(async({filter:n,id:i,options:p}={})=>{let l=this.getEntityManager();if(i){let m=l.getReference(e,i),u=l.remove(m);p?.isFlush!==!1&&await u.flush()}else{let m=dt(n);await l.getRepository(e).nativeDelete(m),p?.isFlush!==!1&&await r.flush()}return{result:!0}},"remove"),search:o(async({keys:n,query:i}={})=>i?{result:await this.getEntityManager().getCollection(e).find({$text:{$search:i}}).toArray()}:{result:[]},"search"),update:o(async({filter:n,id:i,options:p,update:l}={})=>{let m=this.getEntityManager(),u=j(l),{result:c}=await r.get({filter:n,id:i});return c&&(Nn(c).assign(u,{mergeObjectProperties:!0,updateByPrimaryKey:!0}),p?.isFlush!==!1&&await m.persistAndFlush(c)),{result:c}},"update")};return r},"getRepository");this.config=rt(e)}static{o(this,"_Database")}async close(){await this.getEntityManager().getConnection()?.close()}async connect(){this.em=(await xn.init(this.config)).em}async flush(){await this.getEntityManager().flush()}async isConnected(){return this.em?.getConnection().isConnected()??!1}};import Fo from"json-stringify-safe";var jo=o((...[t,e])=>e?.isMinify??!1?Fo(t):Fo(t,null,"  "),"_stringify");import In from"lodash/isString.js";var X=o((...[t,e])=>In(t)?t:t?jo(t,e):"undefined","stringify");var tp=Symbol.for("constructDateFrom");function Lo(t,e,r="long"){return new Intl.DateTimeFormat("en-US",{hour:"numeric",timeZone:t,timeZoneName:r}).format(e).split(/\s/g).slice(2).join(" ")}o(Lo,"tzName");var Fn={},We={};function Pe(t,e){try{let n=(Fn[t]||=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).format)(e).split("GMT")[1];return n in We?We[n]:Go(n,n.split(":"))}catch{if(t in We)return We[t];let r=t?.match(jn);return r?Go(t,r.slice(1)):NaN}}o(Pe,"tzOffset");var jn=/([+-]\d\d):?(\d\d)?/;function Go(t,e){let r=+(e[0]||0),n=+(e[1]||0);return We[t]=r>0?r*60+n:r*60-n}o(Go,"calcOffset");var L=class t extends Date{static{o(this,"TZDateMini")}constructor(...e){super(),e.length>1&&typeof e[e.length-1]=="string"&&(this.timeZone=e.pop()),this.internal=new Date,isNaN(Pe(this.timeZone,this))?this.setTime(NaN):e.length?typeof e[0]=="number"&&(e.length===1||e.length===2&&typeof e[1]!="number")?this.setTime(e[0]):typeof e[0]=="string"?this.setTime(+new Date(e[0])):e[0]instanceof Date?this.setTime(+e[0]):(this.setTime(+new Date(...e)),ko(this,NaN),Zt(this)):this.setTime(Date.now())}static tz(e,...r){return r.length?new t(...r,e):new t(Date.now(),e)}withTimeZone(e){return new t(+this,e)}getTimezoneOffset(){return-Pe(this.timeZone,this)}setTime(e){return Date.prototype.setTime.apply(this,arguments),Zt(this),+this}[Symbol.for("constructDateFrom")](e){return new t(+new Date(e),this.timeZone)}},Ho=/^(get|set)(?!UTC)/;Object.getOwnPropertyNames(Date.prototype).forEach(t=>{if(!Ho.test(t))return;let e=t.replace(Ho,"$1UTC");L.prototype[e]&&(t.startsWith("get")?L.prototype[t]=function(){return this.internal[e]()}:(L.prototype[t]=function(){return Date.prototype[e].apply(this.internal,arguments),Ln(this),+this},L.prototype[e]=function(){return Date.prototype[e].apply(this,arguments),Zt(this),+this}))});function Zt(t){t.internal.setTime(+t),t.internal.setUTCMinutes(t.internal.getUTCMinutes()-t.getTimezoneOffset())}o(Zt,"syncToInternal");function Ln(t){Date.prototype.setFullYear.call(t,t.internal.getUTCFullYear(),t.internal.getUTCMonth(),t.internal.getUTCDate()),Date.prototype.setHours.call(t,t.internal.getUTCHours(),t.internal.getUTCMinutes(),t.internal.getUTCSeconds(),t.internal.getUTCMilliseconds()),ko(t)}o(Ln,"syncFromInternal");function ko(t){let e=Pe(t.timeZone,t),r=new Date(+t);r.setUTCHours(r.getUTCHours()-1);let n=-new Date(+t).getTimezoneOffset(),i=-new Date(+r).getTimezoneOffset(),p=n-i,l=Date.prototype.getHours.apply(t)!==t.internal.getUTCHours();p&&l&&t.internal.setUTCMinutes(t.internal.getUTCMinutes()+p);let m=n-e;m&&Date.prototype.setUTCMinutes.call(t,Date.prototype.getUTCMinutes.call(t)+m);let u=Pe(t.timeZone,t),M=-new Date(+t).getTimezoneOffset()-u,_=u!==e,b=M-m;if(_&&b){Date.prototype.setUTCMinutes.call(t,Date.prototype.getUTCMinutes.call(t)+b);let P=Pe(t.timeZone,t),g=u-P;g&&(t.internal.setUTCMinutes(t.internal.getUTCMinutes()+g),Date.prototype.setUTCMinutes.call(t,Date.prototype.getUTCMinutes.call(t)+g))}}o(ko,"adjustToSystemTZ");var Jt=class t extends L{static{o(this,"TZDate")}static tz(e,...r){return r.length?new t(...r,e):new t(Date.now(),e)}toISOString(){let[e,r,n]=this.tzComponents(),i=`${e}${r}:${n}`;return this.internal.toISOString().slice(0,-1)+i}toString(){return`${this.toDateString()} ${this.toTimeString()}`}toDateString(){let[e,r,n,i]=this.internal.toUTCString().split(" ");return`${e?.slice(0,-1)} ${n} ${r} ${i}`}toTimeString(){let e=this.internal.toUTCString().split(" ")[4],[r,n,i]=this.tzComponents();return`${e} GMT${r}${n}${i} (${Lo(this.timeZone,this)})`}toLocaleString(e,r){return Date.prototype.toLocaleString.call(this,e,{...r,timeZone:r?.timeZone||this.timeZone})}toLocaleDateString(e,r){return Date.prototype.toLocaleDateString.call(this,e,{...r,timeZone:r?.timeZone||this.timeZone})}toLocaleTimeString(e,r){return Date.prototype.toLocaleTimeString.call(this,e,{...r,timeZone:r?.timeZone||this.timeZone})}tzComponents(){let e=this.getTimezoneOffset(),r=e>0?"-":"+",n=String(Math.floor(Math.abs(e)/60)).padStart(2,"0"),i=String(Math.abs(e)%60).padStart(2,"0");return[r,n,i]}withTimeZone(e){return new t(+this,e)}[Symbol.for("constructDateFrom")](e){return new t(+new Date(e),this.timeZone)}};var Qt="America/New_York";import{format as Gn,isValid as Hn,parse as kn}from"date-fns";import $n from"lodash/isPlainObject.js";import Bn from"lodash/isString.js";var ct=class{static{o(this,"_DateTime")}constructor(...[e,r]){let n=r?.tz??Qt,i=new L;e instanceof Date?i=new L(e,n):Bn(e)?i=r?.format?kn(e,r.format,new L).withTimeZone(n):new L(e,n):$n(e)&&(i=new L(e?.year??i.getFullYear(),(e?.month??i.getMonth())-1,e?.day??i.getDate(),e?.hour??i.getHours(),e?.minute??i.getMinutes(),e?.second??i.getSeconds(),e?.millisecond??i.getMilliseconds(),n)),this._date=i}format(e){return e?Gn(this._date,e):this._date.toISOString()}isValid(){return Hn(this._date)}get date(){return this._date}get tz(){return this._date.timeZone??Qt}set tz(e){this._date=this._date.withTimeZone(e)}};var k=class extends ct{static{o(this,"DateTime")}constructor(...e){super(...e)}};import{pino as Yn}from"pino";var yt=class{constructor({level:e}){this.debug=o(e=>this._logger.debug(e),"debug");this.error=o(e=>this._logger.error(e),"error");this.info=o(e=>this._logger.info(e),"info");this.trace=o(e=>this._logger.trace(e),"trace");this.warn=o(e=>this._logger.warn(e),"warn");this._logger=Yn({level:e,transport:{pipeline:[{options:{colorize:!0,destination:2},target:"pino-pretty"}]}})}static{o(this,"_Logger")}};import Wn from"lodash/isPlainObject.js";var se=o(t=>{let e=t.map(r=>r instanceof Error?`Error: ${r}`:Wn(r)?X(r):H(r)?r.map(n=>se([n])):r).join(`
`);return`[${new k().format()}] ${e}`},"format"),eo=class{constructor(e){this.debug=o((...e)=>this._logger.debug(se(e)),"debug");this.error=o((...e)=>this._logger.error(se(e)),"error");this.info=o((...e)=>this._logger.info(se(e)),"info");this.progress=o((...e)=>this._logger.info(`\u231B ${se(e)}...`),"progress");this.raise=o((...e)=>this._logger.error(`\u274C ${se(e)}`),"raise");this.success=o((...e)=>this._logger.info(`\u2705 ${se(e)}`),"success");this.trace=o((...e)=>this._logger.trace(se(e)),"trace");this.warn=o((...e)=>this._logger.warn(se(e)),"warn");this._logger=new yt(e)}static{o(this,"Logger")}},R=new eo({level:"info"});var pe=class extends ut{static{o(this,"Database")}async close(){await this.isConnected()&&(R.info(`Closing connection ${this.config.clientUrl}`),await super.close())}async connect(){await this.isConnected()?R.info(`Reusing connection ${this.config.clientUrl}`):(R.progress(`Connecting ${this.config.clientUrl}`),await super.connect())}};import{Container as Kn}from"inversify";import Vn from"lodash/isFunction.js";var ft=new Kn({autobind:!0,defaultScope:"Singleton"}),G={container:o(()=>ft,"container"),get:o((t,e)=>ft.get(t,e?{name:e}:void 0),"get"),set:o((t,e,r)=>{let n=Vn(e)?ft.bind(t).to(e):ft.bind(t).toDynamicValue(()=>e);r&&n.whenNamed(r)},"set")};var Tt=class extends Error{static{o(this,"TimeoutError")}constructor(e,r=0){super(`${e} timedout after ${r} seconds`)}};import Et from"pubSub-js";var Mt=class{static{o(this,"_PubSub")}close(){Et.clearAllSubscriptions()}publish(e,r){Et.publishSync(e,r)}subscribeSync(e,r){Et.subscribe(e,(n,i)=>r(i))}unsubscribe(e){Et.unsubscribe(e)}};var we=o((...[t=0,e])=>{let r=e?.isVerbose||!1,n=t/1e3,i=r&&setInterval(()=>{R.debug(`${n}s`),n--,n<=0&&clearInterval(i)},1e3);return new Promise(p=>{setTimeout(()=>(r&&clearInterval(i),p()),t)})},"sleep");var Ke=class extends Mt{static{o(this,"PubSub")}waitFor(e,r){return new Promise((n,i)=>{r&&we(r).then(()=>{this.unsubscribe(e),i(new Tt(e,r))}),this.subscribeSync(e,p=>{this.unsubscribe(e),n(p??void 0)})})}subscribe(e){let{subscribeSync:r}=this;async function*n(){let i=[],p,l=new Promise(u=>p=u),m=!1;for(r(e,u=>{u&&(i=i.concat(u)),p(),l=new Promise(c=>p=c)});!m;)await l,yield*i,i=[]}return o(n,"stream"),n()}},Tm=new Ke;var $o=o(async()=>{await G.get(pe,"mongo").close(),G.get(Ke).close()},"cleanup");var de={expireSeconds:300,pool:{max:10}};import ht from"lodash/isPlainObject.js";import zn from"lodash/mergeWith.js";import Xn from"lodash/uniq.js";var Ie=o((...[t,e="DEEP"])=>zn({},...t,(r,n)=>{switch(e){case"DEEP":return ht(r)&&ht(n)?Ie([r,n],e):r===void 0?n:r;case"DEEP_APPEND":case"DEEP_PREPEND":return H(r)&&H(n)?Xn(e==="DEEP_APPEND"?[...n,...r]:[...r,...n]):ht(r)&&ht(n)?Ie([r,n],e):r===void 0?n:r;default:return r===void 0?n:r}}),"merge");var Bo=o(({overrides:t,params:e,strategy:r})=>Ie([...t?t():[],e()],r),"getConfigs"),Fe=o(({config:t,overrides:e,params:r,strategy:n="DEEP_PREPEND"})=>({config:t?i=>t(Bo({overrides:o(()=>N([i,...e?e():[]]),"overrides"),params:r,strategy:n})):void 0,params:o(()=>Bo({overrides:e,params:r,strategy:n}),"params")}),"defineConfig");function a(t,e,r,n){var i=arguments.length,p=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(t,e,r,n);else for(var m=t.length-1;m>=0;m--)(l=t[m])&&(p=(i<3?l(p):i>3?l(e,r,p):l(e,r))||p);return i>3&&p&&Object.defineProperty(e,r,p),p}o(a,"__decorate");function s(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}o(s,"__metadata");import{Embeddable as Zn,Entity as Jn,Index as Qn}from"@mikro-orm/mongodb";import{InputType as ei,ObjectType as ti}from"type-graphql";var Yo=o(({indices:t=[],isAbstract:e=!1,isDatabase:r=!1,isEmbeddable:n=!1,isSchema:i=!0,isSchemaInput:p=!0,name:l}={})=>m=>{let u=l?.includes("Input"),c=l??m.name;!u&&i&&ti(c)(m),p&&ei(u?c:`${c}Input`)(m);let M=m;if(r){let _=(n?Zn:Jn)({abstract:e,collection:c,tableName:c})(m);n&&(M=_)}for(let{keys:_,type:b}of t)M=Qn({properties:_,type:b})(M);return M},"_withEntity");var _t=class extends Error{static{o(this,"NotImplementedError")}constructor(e){super(`not implemented: ${e}`)}};var f=o(({isAbstract:t=!1,name:e,...r}={})=>{if(!e&&!t)throw new _t("name for non-abstract entity");return n=>Yo({...r,isAbstract:t,name:e})(n)},"withEntity");import{ArrayType as oi,Embedded as ri,Index as ni,ManyToMany as ii,ManyToOne as ai,OneToMany as si,OneToOne as pi,PrimaryKey as mi,Property as ue}from"@mikro-orm/mongodb";import{Field as je,Float as Wo}from"type-graphql";var li=o(({Resource:t,isArray:e,type:r})=>{if(t)return je(()=>e?[t()]:t(),{simple:!0});switch(r){case"primaryKey":case"string":return je(()=>e?[String]:String);case"boolean":return je(()=>e?[Boolean]:Boolean);case"date":return je(()=>e?[Date]:Date);case"number":return je(()=>e?[Wo]:Wo);default:return je(()=>e?[String]:String)}},"getField"),di=o(({Resource:t,defaultValue:e,isArray:r,isOptional:n,leaf:i,name:p,relation:l,root:m,type:u})=>{let c={nullable:n,onCreate:e};if(t)switch(l){case"embedded":return ri({array:r,entity:t,nullable:c.nullable,object:!r});case"manyToMany":return ii({...c,entity:t,inversedBy:i,mappedBy:m,owner:!m});case"oneToMany":return si({...c,entity:t,mappedBy:m,nullable:!0,orphanRemoval:!0,ref:!0});case"manyToOne":return ai({...c,entity:t});case"oneToOne":return pi({...c,entity:t,mappedBy:m,owner:!m});default:return ue({...c,type:o(()=>t,"type")})}if(r)return ue({...c,type:oi});switch(u){case"primaryKey":return mi({...c,type:"ObjectId"});case"id":return ue({...c,type:"ObjectId"});case"boolean":return ue({...c,type:"bool"});case"string":return ue({...c,type:"string"});case"number":return ue({...c,type:"number"});case"date":return ue({...c,type:Date});default:return ue({...c,type:void 0})}},"getColumn"),Ko=o(({Resource:t,defaultValue:e,expire:r,isArray:n,isDatabase:i=!1,isOptional:p,isSchema:l=!0,isUnique:m,leaf:u,name:c,relation:M,root:_,type:b})=>(P,g)=>{(r||m)&&ni({options:r?{expireAfterSeconds:r}:{}})(P,g),l&&li({Resource:t,defaultValue:e,isArray:n,isOptional:p,leaf:u,name:c,relation:M,root:_,type:b})(P,g),i&&di({Resource:t,defaultValue:e,isArray:n,isOptional:p,leaf:u,name:c,relation:M,root:_,type:b})(P,g)},"_withField");var d=o(({...t})=>Ko({...t}),"withField");var Rt="Utility";var ce=class extends Error{static{o(this,"InvalidArgumentError")}};import{BeforeCreate as ci}from"@mikro-orm/mongodb";var yi=o(({type:t})=>{switch(t){case"BEFORE_CREATE":return ci();default:throw new ce}},"getHook"),Vo=o(({type:t})=>(e,r)=>yi({type:t})(e,r),"withHook");import fi from"lodash/forEach.js";import Ti from"lodash/isNil.js";var qo,zo,E=class{static{o(this,"EntityResource")}async beforeCreate(){fi(this,(e,r)=>{Ti(e)&&delete this[r]})}};a([d({isDatabase:!0,type:"primaryKey"}),s("design:type",String)],E.prototype,"_id",void 0);a([d({Resource:o(()=>Date,"Resource"),defaultValue:o(()=>new Date,"defaultValue"),isDatabase:!0}),s("design:type",typeof(qo=typeof Date<"u"&&Date)=="function"?qo:Object)],E.prototype,"created",void 0);a([d({isDatabase:!0,isOptional:!0,type:"boolean"}),s("design:type",Boolean)],E.prototype,"isFixture",void 0);a([Vo({type:"BEFORE_CREATE"}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",typeof(zo=typeof Promise<"u"&&Promise)=="function"?zo:Object)],E.prototype,"beforeCreate",null);E=a([f({isAbstract:!0,isDatabase:!0})],E);var Xo,K=class extends E{static{o(this,"Utility")}};a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],K.prototype,"description",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],K.prototype,"imageSrc",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],K.prototype,"name",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],K.prototype,"pricing",void 0);a([d({isArray:!0,isDatabase:!0,type:"string"}),s("design:type",typeof(Xo=typeof Array<"u"&&Array)=="function"?Xo:Object)],K.prototype,"type",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],K.prototype,"url",void 0);K=a([f({isDatabase:!0,isEmbeddable:!0,name:Rt})],K);var ye=o(({Resource:t,isDatabase:e=!0})=>(r,n)=>d({Resource:t,isArray:!0,isDatabase:e,isOptional:!0,type:"resource"})(r,n),"withEmbeddedField");var Zo="Vendor";var Jo,Qo,Oe=class extends E{static{o(this,"Vendor")}static{Qo=Rt}};a([ye({Resource:o(()=>K,"Resource")}),s("design:type",typeof(Jo=typeof Array<"u"&&Array)=="function"?Jo:Object)],Oe.prototype,Qo,void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],Oe.prototype,"imageSrc",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],Oe.prototype,"name",void 0);Oe=a([f({isDatabase:!0,name:Zo})],Oe);var fe=o(({Resource:t,isArray:e=!1,isDatabase:r=!1,isOptional:n=!0,leaf:i,name:p,relation:l,root:m})=>(u,c)=>d({Resource:t,isArray:e,isDatabase:r,isOptional:n,leaf:i,name:p,relation:l,root:m,type:"resource"})(u,c),"withRefField");var $=o(({Resource:t,isDatabase:e=!0,isOptional:r=!0})=>(n,i)=>fe({Resource:t,isDatabase:e,isOptional:r,relation:"manyToOne"})(n,i),"withManyToOneField");var Le="Access";var Ge="Role";var te=o(({Resource:t,isDatabase:e=!0,isOptional:r=!0,root:n})=>(i,p)=>fe({Resource:t,isArray:!0,isDatabase:e,isOptional:r,relation:"oneToMany",root:n})(i,p),"withOneToManyField");var Te="Group";var er,Ee=class extends E{static{o(this,"Role")}static{er=Te}};a([$({Resource:o(()=>B,"Resource")}),s("design:type",Object)],Ee.prototype,er,void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],Ee.prototype,"name",void 0);Ee=a([f({isDatabase:!0,name:Ge})],Ee);var ro,no,tr,B=class extends E{static{o(this,"Group")}constructor(){super(...arguments),this[ro]=new C(this),this[no]=new C(this)}static{ro=Le,no=Ge}};a([te({Resource:o(()=>Z,"Resource"),root:Te}),s("design:type",Object)],B.prototype,ro,void 0);a([te({Resource:o(()=>Ee,"Resource"),root:Te}),s("design:type",Object)],B.prototype,no,void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],B.prototype,"logo",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],B.prototype,"name",void 0);a([d({isArray:!0,isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",typeof(tr=typeof Array<"u"&&Array)=="function"?tr:Object)],B.prototype,"types",void 0);B=a([f({isDatabase:!0,name:Te})],B);var U=o(({Resource:t,isDatabase:e=!0,isOptional:r=!0,leaf:n,root:i})=>(p,l)=>fe({Resource:t,isArray:!0,isDatabase:e,isOptional:r,leaf:n,relation:"manyToMany",root:i})(p,l),"withManyToManyField");var Ve="Bank";var V="User";var io,q=class extends E{static{o(this,"Bank")}constructor(){super(...arguments),this[io]=new C(this)}static{io=V}};a([U({Resource:o(()=>w,"Resource"),leaf:Ve}),s("design:type",Object)],q.prototype,io,void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],q.prototype,"externalId",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],q.prototype,"fingerprint",void 0);a([d({isOptional:!0,type:"boolean"}),s("design:type",Boolean)],q.prototype,"isPrimary",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],q.prototype,"last4",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],q.prototype,"name",void 0);q=a([f({indices:[{keys:["fingerprint"]}],isDatabase:!0,name:Ve})],q);var qe="Card",bt=(r=>(r.CREDIT="credit",r.DEBIT="debit",r))(bt||{});var ao,or,v=class extends E{static{o(this,"Card")}constructor(){super(...arguments),this[ao]=new C(this)}static{ao=V}};a([U({Resource:o(()=>w,"Resource"),leaf:qe}),s("design:type",Object)],v.prototype,ao,void 0);a([d({isDatabase:!0,type:"number"}),s("design:type",Number)],v.prototype,"expMonth",void 0);a([d({isDatabase:!0,type:"number"}),s("design:type",Number)],v.prototype,"expYear",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],v.prototype,"externalId",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],v.prototype,"fingerprint",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",typeof(or=typeof bt<"u"&&bt)=="function"?or:Object)],v.prototype,"funding",void 0);a([d({isOptional:!0,type:"boolean"}),s("design:type",Boolean)],v.prototype,"isPrimary",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],v.prototype,"last4",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],v.prototype,"name",void 0);v=a([f({indices:[{keys:["fingerprint"]}],isDatabase:!0,name:qe})],v);var Pt="PaymentMethod";var wt=(r=>(r.BANK="bank",r.CARD="card",r))(wt||{});var rr,J=class extends E{static{o(this,"PaymentMethod")}};a([d({type:"string"}),s("design:type",String)],J.prototype,"externalId",void 0);a([d({type:"string"}),s("design:type",String)],J.prototype,"fingerprint",void 0);a([d({type:"string"}),s("design:type",String)],J.prototype,"last4",void 0);a([d({type:"string"}),s("design:type",String)],J.prototype,"name",void 0);a([d({type:"string"}),s("design:type",typeof(rr=typeof wt<"u"&&wt)=="function"?rr:Object)],J.prototype,"type",void 0);J=a([f({name:Pt})],J);var Ot=o(({isDatabase:t=!0}={isDatabase:!0})=>{let e=class extends E{static{o(this,"ProtectedResource")}};return a([$({Resource:o(()=>w,"Resource"),isDatabase:t}),s("design:type",Object)],e.prototype,"createdBy",void 0),e=a([f({isAbstract:!0})],e),e},"createProtectedResource");var ze="Chat";var St="Message";var oe=class extends Ot(){static{o(this,"Message")}};a([$({Resource:o(()=>Q,"Resource")}),s("design:type",Object)],oe.prototype,"chat",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],oe.prototype,"text",void 0);oe=a([f({isDatabase:!0,name:St})],oe);var Q=class extends Ot(){static{o(this,"Chat")}constructor(){super(...arguments),this.messages=new C(this),this.participants=new C(this)}};a([te({Resource:o(()=>oe,"Resource"),root:"chat"}),s("design:type",Object)],Q.prototype,"messages",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],Q.prototype,"name",void 0);a([U({Resource:o(()=>w,"Resource"),leaf:ze}),s("design:type",Object)],Q.prototype,"participants",void 0);Q=a([f({isDatabase:!0,name:ze})],Q);var Ct="LinkedUser";var Dt=(e=>(e.STRIPE="stripe",e))(Dt||{});var nr,Me=class extends E{static{o(this,"LinkedUser")}};a([d({isDatabase:!0,type:"string"}),s("design:type",String)],Me.prototype,"externalId",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",typeof(nr=typeof Dt<"u"&&Dt)=="function"?nr:Object)],Me.prototype,"type",void 0);Me=a([f({isDatabase:!0,name:Ct})],Me);var so,po,mo,lo,ir,ar,uo,co,w=class extends E{static{o(this,"User")}constructor(){super(...arguments),this[so]=new C(this),this[po]=new C(this),this[mo]=new C(this),this[lo]=new C(this),this[uo]=new C(this),this[co]=new C(this)}static{so=Le,po=Ve,mo=qe,lo=ze,ar=Ct,uo=St,co=Pt}};a([te({Resource:o(()=>Z,"Resource"),root:V}),s("design:type",Object)],w.prototype,so,void 0);a([U({Resource:o(()=>q,"Resource"),root:V}),s("design:type",Object)],w.prototype,po,void 0);a([U({Resource:o(()=>v,"Resource"),root:V}),s("design:type",Object)],w.prototype,mo,void 0);a([U({Resource:o(()=>Q,"Resource"),root:"participants"}),s("design:type",Object)],w.prototype,lo,void 0);a([ye({Resource:o(()=>Me,"Resource")}),s("design:type",typeof(ir=typeof Array<"u"&&Array)=="function"?ir:Object)],w.prototype,ar,void 0);a([te({Resource:o(()=>oe,"Resource"),root:"createdBy"}),s("design:type",Object)],w.prototype,uo,void 0);a([U({Resource:o(()=>v,"Resource"),root:V}),s("design:type",Object)],w.prototype,co,void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],w.prototype,"callingCode",void 0);a([d({isDatabase:!0,isOptional:!0,isUnique:!0,type:"string"}),s("design:type",String)],w.prototype,"email",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],w.prototype,"first",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],w.prototype,"last",void 0);a([fe({Resource:o(()=>J,"Resource"),isDatabase:!0,isOptional:!0}),s("design:type",Object)],w.prototype,"paymentMethodPrimary",void 0);a([d({isDatabase:!0,isOptional:!0,isUnique:!0,type:"string"}),s("design:type",String)],w.prototype,"phone",void 0);w=a([f({indices:[{keys:["first","last","email","phone"],type:"text"}],isDatabase:!0,name:V})],w);var pr,sr,mr,lr,Z=class extends E{static{o(this,"Access")}static{pr=Te,mr=Ge,lr=V}};a([$({Resource:o(()=>B,"Resource")}),s("design:type",Object)],Z.prototype,pr,void 0);a([d({isArray:!0,isDatabase:!0,type:"string"}),s("design:type",typeof(sr=typeof Array<"u"&&Array)=="function"?sr:Object)],Z.prototype,mr,void 0);a([$({Resource:o(()=>w,"Resource")}),s("design:type",Object)],Z.prototype,lr,void 0);Z=a([f({isDatabase:!0,name:Le})],Z);import{Authorized as Ei}from"type-graphql";var dr=o(t=>Ei(t),"_withAccess");var ur=o((...[t,e])=>(...r)=>{if(t()){let n=e();return H(n)?n.forEach(i=>i(...r)):n(...r)}},"withCondition");var hi=o(t=>{switch(t){case"RESTRICTED":return["Admin"];case"PROTECTED":return["User"];default:return[]}},"getAccessRole"),cr=o(({access:t="RESTRICTED"}={access:"RESTRICTED"})=>ur(()=>t!=="PUBLIC",()=>dr(hi(t))),"withAccess");var yr,re=class extends E{static{o(this,"Otp")}};a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],re.prototype,"callingCode",void 0);a([d({Resource:o(()=>Date,"Resource"),defaultValue:o(()=>new Date,"defaultValue"),expire:de.expireSeconds,isDatabase:!0}),s("design:type",typeof(yr=typeof Date<"u"&&Date)=="function"?yr:Object)],re.prototype,"created",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],re.prototype,"email",void 0);a([d({type:"boolean"}),s("design:type",Boolean)],re.prototype,"isCheckExists",void 0);a([cr({access:"RESTRICTED"}),d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],re.prototype,"otp",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],re.prototype,"phone",void 0);re=a([f({indices:[{keys:["email","phone"],type:"text"}],isDatabase:!0,name:"Otp"})],re);var me=class{static{o(this,"ProductItem")}};a([d({type:"string"}),s("design:type",String)],me.prototype,"name",void 0);a([d({isOptional:!0,type:"number"}),s("design:type",Number)],me.prototype,"price",void 0);a([d({type:"string"}),s("design:type",String)],me.prototype,"pricingId",void 0);a([d({type:"string"}),s("design:type",String)],me.prototype,"productId",void 0);a([d({isOptional:!0,type:"number"}),s("design:type",Number)],me.prototype,"quantity",void 0);me=a([f({name:"ProductItem"})],me);var fr="Order",At=(n=>(n.CANCELED="canceled",n.COMPLETED="completed",n.REFUNDED="refunded",n))(At||{});var Tr,Er,Se=class extends E{static{o(this,"Order")}};a([d({Resource:o(()=>me,"Resource"),isArray:!0,isDatabase:!0,isOptional:!0,type:"resource"}),s("design:type",typeof(Tr=typeof Array<"u"&&Array)=="function"?Tr:Object)],Se.prototype,"items",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],Se.prototype,"paymentMethodId",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",typeof(Er=typeof At<"u"&&At)=="function"?Er:Object)],Se.prototype,"status",void 0);Se=a([f({isDatabase:!0,name:fr})],Se);var xt="Pricing",Nt=(e=>(e.RECURRING="recurring",e))(Nt||{});var vt="Product";var hr,Mr,he=class extends E{static{o(this,"Pricing")}static{hr=vt}};a([$({Resource:o(()=>ne,"Resource")}),s("design:type",Object)],he.prototype,hr,void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],he.prototype,"currency",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",typeof(Mr=typeof Nt<"u"&&Nt)=="function"?Mr:Object)],he.prototype,"frequency",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],he.prototype,"price",void 0);he=a([f({isDatabase:!0,isEmbeddable:!0,name:xt})],he);var _r,Rr,gr,ne=class extends E{static{o(this,"Product")}static{Rr=xt}};a([ye({Resource:o(()=>he,"Resource")}),s("design:type",typeof(_r=typeof Array<"u"&&Array)=="function"?_r:Object)],ne.prototype,Rr,void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],ne.prototype,"description",void 0);a([d({isArray:!0,isOptional:!0,type:"string"}),s("design:type",typeof(gr=typeof Array<"u"&&Array)=="function"?gr:Object)],ne.prototype,"imageSrc",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],ne.prototype,"name",void 0);ne=a([f({isDatabase:!0,name:vt})],ne);var br="Socket";var Pr,wr,Ce=class extends E{static{o(this,"Socket")}};a([d({isDatabase:!0,type:"string"}),s("design:type",typeof(Pr=typeof Array<"u"&&Array)=="function"?Pr:Object)],Ce.prototype,"connections",void 0);a([d({Resource:o(()=>Date,"Resource"),defaultValue:o(()=>new Date,"defaultValue"),expire:de.expireSeconds,isDatabase:!0}),s("design:type",typeof(wr=typeof Date<"u"&&Date)=="function"?wr:Object)],Ce.prototype,"created",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],Ce.prototype,"name",void 0);Ce=a([f({isDatabase:!0,name:br})],Ce);var Xe=class extends E{static{o(this,"SourcedEntityResource")}};a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],Xe.prototype,"source",void 0);Xe=a([f({isAbstract:!0})],Xe);var Ze="Curve",yo=[{unit:"mo",value:1},{unit:"mo",value:2},{unit:"mo",value:3},{unit:"mo",value:4},{unit:"mo",value:5},{unit:"mo",value:6},{unit:"yr",value:1},{unit:"yr",value:2},{unit:"yr",value:3},{unit:"yr",value:5},{unit:"yr",value:7},{unit:"yr",value:10},{unit:"yr",value:20},{unit:"yr",value:30},{unit:"yr",value:40}];var Or,Sr,D=class extends Xe{static{o(this,"Curve")}};a([d({isDatabase:!0,isUnique:!0,type:"date"}),s("design:type",typeof(Or=typeof Date<"u"&&Date)=="function"?Or:Object)],D.prototype,"date",void 0);a([d({isDatabase:!0,isOptional:!0,type:"date"}),s("design:type",typeof(Sr=typeof Date<"u"&&Date)=="function"?Sr:Object)],D.prototype,"lastUpdated",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],D.prototype,"name",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_1mo",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_2mo",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_3mo",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_4mo",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_5mo",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_6mo",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_1yr",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_2yr",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_3yr",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_5yr",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_7yr",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_10yr",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_20yr",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_30yr",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],D.prototype,"value_40yr",void 0);D=a([f({isDatabase:!0,name:Ze})],D);var Cr="Snapshot";var Dr,Ut=class extends E{static{o(this,"Snapshot")}};a([d({isArray:!0,isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",typeof(Dr=typeof Array<"u"&&Array)=="function"?Dr:Object)],Ut.prototype,"images",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],Ut.prototype,"name",void 0);Ut=a([f({isDatabase:!0,name:Cr})],Ut);var Ar="TestableEmbeddedResource";var xr,Nr,I=class extends E{static{o(this,"TestableResource")}};a([d({Resource:o(()=>Date,"Resource"),defaultValue:o(()=>new Date,"defaultValue"),expire:de.expireSeconds,isDatabase:!0,isOptional:!0}),s("design:type",typeof(xr=typeof Date<"u"&&Date)=="function"?xr:Object)],I.prototype,"date",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],I.prototype,"group",void 0);a([d({isDatabase:!0,type:"number"}),s("design:type",Number)],I.prototype,"index",void 0);a([d({isDatabase:!0,isOptional:!0,type:"number"}),s("design:type",Number)],I.prototype,"number",void 0);a([d({isDatabase:!0,type:"string"}),s("design:type",String)],I.prototype,"string",void 0);a([d({isArray:!0,isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",typeof(Nr=typeof Array<"u"&&Array)=="function"?Nr:Object)],I.prototype,"stringArray",void 0);a([d({isDatabase:!0,isOptional:!0,type:"string"}),s("design:type",String)],I.prototype,"stringOptional",void 0);I=a([f({isAbstract:!0,isDatabase:!0})],I);var It=class extends I{static{o(this,"TestableEmbeddedResource")}};It=a([f({isDatabase:!0,isEmbeddable:!0,name:Ar})],It);var vr="TestableEntityResource";var Ur="TestableRelatedResource";var De=class extends I{static{o(this,"TestableRelatedResource")}};a([U({Resource:o(()=>_e,"Resource"),leaf:"relatedManyToMany"}),s("design:type",Object)],De.prototype,"rootManyToMany",void 0);a([$({Resource:o(()=>_e,"Resource")}),s("design:type",Object)],De.prototype,"rootOneToMany",void 0);De=a([f({isDatabase:!0,name:Ur})],De);var Ir,_e=class extends I{static{o(this,"TestableEntityResource")}constructor(){super(...arguments),this.relatedManyToMany=new C(this),this.relatedOneToMany=new C(this)}};a([ye({Resource:o(()=>It,"Resource")}),s("design:type",typeof(Ir=typeof Array<"u"&&Array)=="function"?Ir:Object)],_e.prototype,"embedded",void 0);a([U({Resource:o(()=>De,"Resource"),root:"rootManyToMany"}),s("design:type",Object)],_e.prototype,"relatedManyToMany",void 0);a([te({Resource:o(()=>De,"Resource"),root:"rootOneToMany"}),s("design:type",Object)],_e.prototype,"relatedOneToMany",void 0);_e=a([f({isDatabase:!0,name:vr})],_e);var Ri=Fe({config:rt,params:o(()=>({...de,entities:N([Z,q,v,Q,B,Me,oe,Se,re,J,ne,Ee,Ce,D,w,K,Oe])}),"params")}),Fr=Ri;var fo=Fe({...Fr,overrides:o(()=>[{database:process.env.SERVER_DB_MONGO_NAME,host:process.env.SERVER_DB_MONGO_URL,password:process.env.SERVER_DB_MONGO_PASSWORD,type:"mongo",username:process.env.SERVER_DB_MONGO_USERNAME}],"overrides")});import bi from"close-with-grace";var jr,Lr=o(async({onCleanUp:t})=>{bi({delay:1e3},async({signal:e})=>{jr||(R.debug(`shutting down due to ${e}`),await t?.(),jr=!0)})},"_handleCleanup");var Gr=o(t=>Lr(t),"handleCleanup");var Ft,Hr=o(async({database:t=fo.params()}={database:fo.params()})=>{let e=o(async()=>{await $o()},"onCleanUp");if(await Gr({onCleanUp:e}),!Ft&&(Ft={},t))try{let r=new pe(t);await r.connect(),G.set(pe,r,"mongo"),Ft.database=r}catch(r){R.raise(`Failed to connect to ${t.host}`,r)}return{...Ft,cleanUp:e}},"initialize");var To=o(()=>typeof performance<"u"&&performance.now?performance.now():Date.now(),"now"),kr=o(t=>{let e=o((...r)=>{let n=To(),i=t(...r);if(i instanceof Promise)return i.then(p=>{let l=To();return R.info(`${t.name} took ${(l-n).toFixed(3)} ms`),p});{let p=To();return R.info(` ${t.name} took ${(p-n).toFixed(3)} ms`),i}},"wrapped");return Object.defineProperty(e,"name",{value:t.name}),e},"timeit");import{basename as $r}from"path";import jt from"process";import{fileURLToPath as Pi}from"url";var Br=o(async({job:t,onFinish:e})=>{if($r(Pi(import.meta.url))===$r(jt.argv[1])){R.progress("Starting");try{await kr(t)(),R.success("Completed")}catch(n){R.raise("Failed",n),jt.exitCode=1}finally{await e?.()}jt.exit(jt.exitCode||0)}},"createJob");var Yr=o(async({loaders:t,...e})=>Br({...e,job:o(async()=>{let{cleanUp:r}=await Hr();for(let n of t)try{await n.upload(),R.success(`Upload complete: ${n.name}`)}catch(i){R.raise(`Upload failed: ${n.name}`,i)}await r?.()},"job")}),"createDataUploadJob");import{injectable as wi}from"inversify";var Wr=wi;var Lt=o(({name:t}={})=>e=>(Wr()(e),t&&G.set(t,e),e),"withContainer");var Je=o(async t=>{if(t.length===0)return[];let[e,...r]=t;return[await e(),...await Je(r)]},"mapSequence");var He=o(t=>t?.map(({booleanValue:e,condition:r,dateValue:n,field:i,numberValue:p,resourceArrayValue:l,resourceValue:m,stringArrayValue:u,stringValue:c,value:M})=>({condition:r,field:i,value:M??e??n??p??m??l??c??u}))??[],"collapseFilter");import Oi from"lodash/forEach.js";var Kr=o(({Resource:t,afterCreate:e,afterCreateMany:r,afterGet:n,afterGetConnection:i,afterGetMany:p,afterRemove:l,afterSearch:m,afterUpdate:u,beforeCreate:c,beforeCreateMany:M,beforeGet:_,beforeGetConnection:b,beforeGetMany:P,beforeRemove:g,beforeSearch:z,beforeUpdate:W,count:ie,create:F,createMany:S,get:x,getConnection:ae,getMany:Re,remove:le,search:qt,update:fn})=>{class Tn{constructor(){this.decorators={afterCreate:e,afterCreateMany:r,afterGet:n,afterGetConnection:i,afterGetMany:p,afterRemove:l,afterSearch:m,afterUpdate:u,beforeCreate:o(async({input:h},T)=>{let y=new t;Oi(h?.form,(ot,En)=>y[En]=ot),y._id=y._id??new be,y.created=y.created??new Date,await y.beforeCreate?.();let O={...h,form:y};return c?c({input:O},T):O},"beforeCreate"),beforeCreateMany:M,beforeGet:o(async({input:h},T)=>{let y={...h,filter:He(h?.filter)};return _?_({input:y},T):y},"beforeGet"),beforeGetConnection:o(async({input:h},T)=>{let y={...h,filter:He(h?.filter)};return b?b({input:y},T):y},"beforeGetConnection"),beforeGetMany:o(async({input:h},T)=>{let y={...h,filter:He(h?.filter)};return P?P({input:y},T):y},"beforeGetMany"),beforeRemove:o(async({input:h},T)=>{let y={...h,filter:He(h?.filter)};return g?g({input:y},T):y},"beforeRemove"),beforeSearch:z,beforeUpdate:o(async({input:h},T)=>{let y={...h,filter:He(h?.filter)};return W?W({input:y},T):y},"beforeUpdate")};this.create=this.create.bind(this),this.createMany=this.createMany.bind(this),this.get=this.get.bind(this),this.getMany=this.getMany.bind(this),this.getConnection=this.getConnection.bind(this),this.update=this.update.bind(this),this.search=this.search.bind(this),this.remove=this.remove.bind(this)}static{o(this,"ResourceImplementation")}async count(h){return ie(h)}async create(h,T){let y=j(h);y=this.decorators.beforeCreate?await this.decorators.beforeCreate({input:y},T):y;let O=await F(y,T);return this.decorators.afterCreate?this.decorators.afterCreate({input:y,output:O},T):O}async createMany(h,T){let y=j(h);y=this.decorators.beforeCreateMany?await this.decorators.beforeCreateMany({input:y},T):y,y?.form&&(y.form=await Je(y.form?.map(ot=>async()=>this.decorators.beforeCreate?(await this.decorators.beforeCreate({input:{form:ot}},T))?.form:ot)));let O=await S(y,T);return this.decorators.afterCreateMany?this.decorators.afterCreateMany({input:y,output:O},T):O}async get(h,T){let y=j(h);y=this.decorators.beforeGet?await this.decorators.beforeGet({input:y},T):y;let O=await x(y,T);return this.decorators.afterGet?this.decorators.afterGet({input:y,output:O},T):O}async getConnection(h,T){let y=j(h);y=this.decorators.beforeGetConnection?await this.decorators.beforeGetConnection({input:y},T):y;let O=await ae(y,T);return this.decorators.afterGetConnection?this.decorators.afterGetConnection({input:y,output:O},T):O}async getMany(h,T){let y=j(h);y=this.decorators.beforeGetMany?await this.decorators.beforeGetMany({input:y},T):y;let O=await Re(y,T);return this.decorators.afterGetMany?this.decorators.afterGetMany({input:y,output:O},T):O}async remove(h,T){let y=j(h);y=this.decorators.beforeRemove?await this.decorators.beforeRemove({input:y},T):y;let O=await le(y,T);return this.decorators.afterRemove?this.decorators.afterRemove({input:y,output:O},T):O}async search(h,T){let y=j(h);y=this.decorators.beforeSearch?await this.decorators.beforeSearch({input:y},T):y;let O=await qt(y,T);return this.decorators.afterSearch?this.decorators.afterSearch({input:y,output:O},T):O}async update(h,T){let y=j(h);y=this.decorators.beforeUpdate?await this.decorators.beforeUpdate({input:y},T):y;let O=await fn(y,T);return this.decorators.afterUpdate?this.decorators.afterUpdate({input:y,output:O},T):O}}return Tn},"createResourceImplementation");var Vr=o(({Resource:t,afterCreate:e,afterCreateMany:r,afterGet:n,afterGetConnection:i,afterGetMany:p,afterRemove:l,afterSearch:m,afterUpdate:u,beforeCreate:c,beforeCreateMany:M,beforeGet:_,beforeGetConnection:b,beforeGetMany:P,beforeRemove:g,beforeSearch:z,beforeUpdate:W,name:ie})=>{let F=o(()=>G.get(pe,"mongo").getRepository({name:ie}),"getRepository");return Kr({Resource:t,afterCreate:e,afterCreateMany:r,afterGet:n,afterGetConnection:i,afterGetMany:p,afterRemove:l,afterSearch:m,afterUpdate:u,beforeCreate:c,beforeCreateMany:M,beforeGet:_,beforeGetConnection:b,beforeGetMany:P,beforeRemove:g,beforeSearch:z,beforeUpdate:W,count:o(async S=>F().count(S?.filter),"count"),create:o(async S=>F().create(S),"create"),createMany:o(async S=>F().createMany(S),"createMany"),get:o(async S=>F().get(S),"get"),getConnection:o(async S=>F().getConnection(S),"getConnection"),getMany:o(async S=>F().getMany(S),"getMany"),name:ie,remove:o(async S=>F().remove(S),"remove"),search:o(async S=>F().search(S),"search"),update:o(async S=>F().update(S),"update")})},"createEntityResourceImplementation");var ke=class extends Vr({Resource:D,name:Ze}){static{o(this,"CurveImplementation")}};ke=a([Lt({name:`${Ze}Implementation`})],ke);var Qe=o(async t=>{if(t.length===0)return[];let[e,...r]=t;return[await e(),...await Qe(r)]},"mapParallel");var Ae=class extends Error{static{o(this,"NotFoundError")}constructor(e){super(`not found: ${e}`)}};var ge=class{static{o(this,"DataLoader")}constructor(e){this.params=e}async fetch(){throw new Error("Method not implemented.")}async fetchPostProcess(){return(await this.fetch()).map(e=>({...e,source:e.source??this.params?.source}))}async upload(){if(this.params.ResourceImplementation){let e=await this.fetchPostProcess();return await G.get(this.params.ResourceImplementation)?.createMany?.({form:e}),e}throw new Ae("resource implementaiton")}get name(){return this.params.name??this.constructor.name}get source(){return this.params.source}};var $e=class extends ge{static{o(this,"MultiSourceDataLoader")}constructor(e){super(e)}async fetch(){return(await Qe(this.params.loaders.map(e=>async()=>{try{return await e.fetchPostProcess()}catch(r){return R.error(`skipping ${e.source} with error: ${r}`),[]}}))).flat()}};import Si from"lodash/isNumber.js";import Ci from"lodash/isString.js";var qr=o(t=>Si(t)?isFinite(t):Ci(t)?/^[+-]?(?:\d+\.?\d*|\.\d+)([eE][+-]?\d+)?$/.test(t.trim()):!1,"isNumeric");import Di from"lodash/trimStart.js";import{join as Ai}from"path";var xe=o((...[t,e])=>{let r=Ai(...N(t));return e?.extension&&(r=`${r}.${Di(e.extension,".")}`),r},"joinPaths");var zr=o((...t)=>xe([process.cwd(),...t]),"fromWorking");var Eo="__build__",xi="__cache__",Ni="__temp__",vi=[Eo,xi,Ni,"__pycache__",".coverage*",".DS_Store",".esbuild",".eslintcache",".pytest_cache",".serverless",".swc",".test",".vite",".wrangler","*.0x","*.log*","coverage"];var Xr="webp",Zr="mp4",bh=[...vi,".git",".venv","ios/Pods","node_modules"];import Jr from"@sparticuz/chromium";var Gt=o(({delay:t,dimension:e,elementTimeout:r,isHeadless:n,isIgnoreMedia:i,navigationTimeout:p,proxies:l,snapshotPath:m})=>({args:N([...Jr.args,"--disable-dev-shm-usage","--disable-features=site-per-process","--disable-gpu","--disable-setuid-sandbox","--disable-web-security","--ignore-certificate-errors","--no-first-run","--no-sandbox","--no-zygote"]).filter(u=>!u.includes("--use-gl")).filter(Boolean),defaultViewport:e,headless:Jr.headless,protocolTimeout:0}),"_screen");var Ui=Fe({config:Gt,params:o(()=>({delay:1e3,dimension:{height:550,width:750},elementTimeout:1e4,imageExtension:Xr,isHeadless:!0,isIgnoreMedia:!0,navigationTimeout:12e4,retry:1,snapshotPath:process.env.NODE_RUNTIME==="AWS_LAMBDA"?void 0:zr(Eo,"snapshots"),videoExtension:Zr}),"params")}),Qr=Ui;var Mo=o(t=>{let e=t??process.env.NODE_RUNTIME;return console.info(`@@@${e}`),e==="AWS_LAMBDA"||e==="CONTAINER"},"isCloud");import Ii from"@sparticuz/chromium";import{existsSync as en,mkdirSync as tn}from"fs";import Y from"lodash/isNumber.js";import Fi from"lodash/trim.js";import{executablePath as on}from"puppeteer";import ji from"puppeteer-extra";import{PuppeteerScreenRecorder as Li}from"puppeteer-screen-recorder";Ii.setGraphicsMode=!1;var Ht=class{constructor(e){this.counter=0;this.options=e}static{o(this,"_Screen")}async close(){await this.page.close(),await this.browser.close(),this.counter=0}async find(e,{delay:r=!0,retry:n=!0,timeout:i=!0,...p}={}){let l=(n===!0?this.options.retry:Y(n)?n:0)??0;for(;l>=0;)try{let m=await an(e,{...p,delay:r===!0?this.options.delay:Y(r)?r:0,index:p.index===!0?0:p.index===!1?-1:p.index,timeout:i===!0?this.options.elementTimeout:Y(i)?i:0},this.page);if(m)return m}catch(m){if(l===0&&p.isThrow)throw m}finally{--l}return null}async findAll(e,{delay:r=!0,retry:n=!0,timeout:i=!0,...p}={}){let l=(n===!0?this.options.retry:Y(n)?n:0)??0;for(;l>=0;)try{let m=await sn(e,{...p,delay:r===!0?this.options.delay:Y(r)?r:0,timeout:i===!0?this.options.elementTimeout:Y(i)?i:0},this.page);if(m)return m}catch(m){try{if(l===0&&p.isThrow)throw m}finally{--l}}return[]}async initialize(){let e=Mo()?process.env.PUPPETEER_EXECUTABLE_PATH??on():on();this.browser=await ji.launch({...Gt(this.options),args:Mo()?["--disable-dev-shm-usage","--disable-features=NetworkServiceInProcess2","--disable-features=site-per-process","--disable-gpu","--disable-setuid-sandbox","--disable-web-security","--ignore-certificate-errors","--no-first-run","--no-sandbox","--no-zygote"]:void 0,executablePath:e,protocolTimeout:0}),this.isInitialized=!0,this.page=await this.browser.newPage(),await this.page.setCacheEnabled(!1),await this.page.setUserAgent("Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36"),await this.page.setExtraHTTPHeaders({"Accept-Language":"en-US,en;q=0.9"}),await this.page.setRequestInterception(!0),await this.page.evaluateOnNewDocument(()=>{Object.defineProperty(navigator,"webdriver",{get:o(()=>!1,"get")})}),this.page.on("request",r=>{let n=r.resourceType();if(this.options.isIgnoreMedia&&(n==="image"||n==="font"||n==="media"))r.abort();else{let i=r.headers();r.continue(i)}})}async key(e,{delay:r=!0}={}){await we(r===!0?this.options.delay:Y(r)?r:0);let n=(()=>{switch(e){case"enter":return"Enter";case"up":return"ArrowUp";case"down":return"ArrowDown";default:throw new ce}})();await this.page.keyboard.press(n)}async open(e){if(!this.isInitialized&&await this.initialize(),this.uri()?.pathname!==nt(e)){let r=this.options.rootUri?ee({host:this.options.rootUri,pathname:e}):e;R.debug(`open page ${r}`),await this.page.goto(r,{timeout:this.options.navigationTimeout,waitUntil:"domcontentloaded"}),await this.page.createCDPSession().then(n=>n.send("Page.setDownloadBehavior",{behavior:"allow",downloadPath:"./"}))}}async record({dirname:e,filename:r}={}){let{dimension:n,snapshotPath:i,videoExtension:p}=this.options,l=e??this.options.dirname,m=i&&xe(N([i,l]));m&&!en(m)&&tn(m,{recursive:!0});let u=new Li(this.page,{aspectRatio:"4:3",autopad:{color:"black"},followNewTab:!0,fps:25,videoBitrate:1e3,videoCodec:"libx264",videoCrf:18,videoFrame:{height:n.height??1e3,width:n.width??1e3},videoPreset:"ultrafast"});return this.counter+=1,await u.start(xe([m,`${this.counter}${r?`-${Ye(`${r}`)}`:""}`],{extension:p})),async()=>{await u.stop()}}async snapshot({dirname:e,filename:r}={}){let{delay:n,dimension:i,imageExtension:p,snapshotPath:l}=this.options;await we(n);let m=e??this.options.dirname,u=l&&xe(N([l,m]));return u&&!en(u)&&tn(u,{recursive:!0}),this.counter+=1,this.page.screenshot({clip:{height:i.height??1e3,width:i.width??1e3,x:0,y:0},path:l?xe([u,`${this.counter}${r?`-${Ye(`${r}`)}`:""}`],{extension:p}):void 0,type:p??"webp"})}uri(){if(this.page){let{host:e,pathname:r,port:n,protocol:i}=new URL(this.page.url());return{host:`${i}//${e}`,pathname:r,port:n}}return null}},nn=o(t=>{switch(t.type){case"class":return`.${t.value}`;case"data":return`[${t.key}="${t.value}"]`;case"testID":return`[data-testid="${t.value}"]`;case"id":return`#${t.value}`;case"text":return`::-p-text(${t.value})`;case"frame":return`iframe[${t.key??"name"}="${t.value}"]`;default:return t.value}},"getSelector"),an=o(async(t,{delay:e=0,index:r=-1,isThrow:n=!0,timeout:i=0}={},p)=>{if(p){e&&await we(e);let l=nn(t);try{R.debug(`finding ${X(t,{isMinify:!0})} with ${l}...`),i&&await p.waitForSelector(l,{timeout:i,visible:!0})}catch(u){if(n)throw u;R.warn(u)}let m;if(r>=0?m=(await p.$$(l))?.[r]:m=await p.$(l),m)return t.type==="frame"&&(m=await m.contentFrame()),R.debug(`found ${X(t,{isMinify:!0})}!`),new kt(m,{delay:e,timeout:i})}return n&&new Ae(X(t)),null},"find"),sn=o(async(t,{delay:e,isThrow:r=!0,timeout:n}={},i)=>{if(i){e&&await we(e);let p=nn(t);try{R.debug(`finding all ${X(t,{isMinify:!0})} with ${p}...`),n&&await i.waitForSelector(p,{timeout:n,visible:!0})}catch(m){if(r)throw m;R.warn(m)}let l=await i.$$(p);if(l)return R.debug(`found all ${X(t,{isMinify:!0})}!`),Je(l.map(m=>async()=>{let u=m;return u&&t.type==="frame"&&(u=await u.contentFrame()),u&&new kt(u,{delay:e,timeout:n})}))}return r&&new Ae(X(t,{isMinify:!0})),[]},"findAll"),kt=class t{static{o(this,"_Handle")}constructor(e,r){this.handle=e,this.options=r}async content(){return await this.handle.evaluate(async r=>r?.innerHTML)??null}async find(e,{delay:r=!0,retry:n=!0,timeout:i=!0,...p}={}){let l=(n===!0?this.options.retry:Y(n)?n:0)??0;for(;l>=0;)try{let m=await an(e,{...p,delay:r===!0?this.options.delay:Y(r)?r:0,timeout:i===!0?this.options.timeout:Y(i)?i:0},this.handle);if(m)return m}catch(m){if(l===0&&p.isThrow)throw m}finally{--l}return null}async findAll(e,{delay:r=!0,retry:n=!0,timeout:i=!0,...p}={}){let l=(n===!0?this.options.retry:Y(n)?n:0)??0;for(;l>=0;)try{let m=await sn(e,{...p,delay:r===!0?this.options.delay:Y(r)?r:0,timeout:i===!0?this.options.timeout:Y(i)?i:0},this.handle);if(m)return m}catch(m){if(l===0&&p.isThrow)throw m}finally{--l}return[]}async next(){let e=await this.handle.evaluateHandle(r=>r?.nextElementSibling);return e?new t(e,this.options):null}async parent(){let e=await this.handle.evaluateHandle(r=>r?.parentNode);return e?new t(e,this.options):null}async press(){await this.handle.click()}async previous(){let e=await this.handle.evaluateHandle(r=>r?.previousElementSibling);return e?new t(e,this.options):null}async select(e){this.handle.select&&await this.handle.select(e)}async src(){return await this.handle.evaluate(async r=>r?.src)??null}async text(){let e=await this.handle.evaluate(async r=>r?.innerText);return e?Fi(e.replaceAll(`
`," ")):null}async type(e){await this.handle.type(e)}async url(){return await this.handle.evaluate(async r=>r?.href)??null}async value(){return await this.handle.evaluate(async r=>r?.value)??null}};var $t=class extends Ht{static{o(this,"Screen")}constructor(e={}){super(Ie([e,Qr.params()]))}};var Bt=class extends ge{static{o(this,"CrawlDataLoader")}constructor(e){let r=e.source??e.uri;super({...e,name:e.name??r,source:r})}async fetch(){let{transformer:e,uri:r}=this.params,n=new $t;try{return await n.open(r),await e(n)}catch(i){console.warn(i),await n.close()}return[]}};import et from"lodash/isFunction.js";var Be=class extends Bt{static{o(this,"TableCrawlDataLoader")}constructor({cellsSelector:e={value:"th, td"},dateSelector:r,lastUpdatedSelector:n,nCols:i,nRows:p,rowsSelector:l={value:"tr"},skipRows:m=0,tableSelector:u={value:"table"},transformer:c,...M}){super({...M,transformer:o(async _=>{let b=et(u)?await u(_):await _.find(u);if(b){let P=et(l)?await l(_,b):await b.findAll(l);p&&(P=P.slice(0,p+1));let g=[];for(let x of P){let ae=et(e)?await e(_,x):await x.findAll(e);i&&(ae=ae.slice(0,i)),g.push(await Qe(ae?.map(Re=>async()=>Re.text())))}let z=g.slice(0,m+1),W=g.slice(m+1),ie=z[0].map(x=>x??""),S={data:W.map(x=>j(Object.fromEntries(ie.map((ae,Re)=>{let le=x[Re];return[ae,le&&qr(le)?parseFloat(le):le]})))),headers:ie};if(n){let x=et(n)?await n(_,b):await b.find(n);x&&(S.lastUpdated=await x.text())}if(r){let x=et(r)?await r(_,b):await b.find(r);x&&(S.date=await x.text())}return c(S)}return[]},"transformer")})}};var pn="oisSwapRate";import Gi from"lodash/toNumber.js";var mn=new $e({ResourceImplementation:ke,loaders:[new Be({lastUpdatedSelector:{value:"footer"},nCols:2,tableSelector:o(async t=>{let e=await t.findAll({type:"class",value:"rates"});for(let r of e)if((await r.find({value:"header"})?.then(i=>i?.text()))?.includes("SOFR swap rate (annual/annual)"))return r;return null},"tableSelector"),transformer:o(({data:t,headers:e,lastUpdated:r})=>{let n=e[1],{date:i}=new k(n,{format:"dd MMM yyyy"}),p={date:i,name:pn},l=r?.match(/(\d{2} \w{3} \d{4}) \| (\d{2}:\d{2}) (\w{2})/);if(l){let[m,u,c,M]=l;p.lastUpdated=new Date(`${u} ${c} GMT-0400`)}return t.forEach(m=>{let u=m[""].replace(" Year",""),c=m[n].replace("%","");p[`value_${u}yr`]=Gi(c)}),[p]},"transformer"),uri:"https://www.chathamfinancial.com/technology/us-market-rates"})]});import ki from"axios";var Yt=class{constructor({baseUri:e,onError:r,onRequest:n,onResponse:i,request:p}={}){this.delete=o(async({params:e,request:r,url:n})=>this.request("DELETE",{request:r,url:ee({host:n,params:e})}),"delete");this.get=o(async({onMessage:e,params:r,request:n,url:i})=>this.request("GET",{onMessage:e,request:n,url:ee({host:i,params:r})}),"get");this.post=o(async({onMessage:e,params:r,request:n,url:i})=>this.request("POST",{onMessage:e,params:r,request:n,url:i}),"post");this.put=o(async({params:e,request:r,url:n})=>this.request("PUT",{params:e,request:r,url:n}),"put");this.request=o(async(e,{onMessage:r,params:n,request:i,url:p})=>{try{let l=await this._instance.request({...i,adapter:"fetch",data:n,method:e,url:p??""});if(i?.responseType==="stream"&&r){let m=l?.data?.getReader(),u=new TextDecoder;for(;;){let{done:c,value:M}=await m.read();if(c)break;let b=u.decode(M,{stream:!0}).split(`
`).reduce((P,g)=>g.startsWith("data:")?[...P,g.replace("data:","")]:P,[]);for(let P of b){let g=P;try{({data:g}=JSON.parse(P))}catch{}r(g)}}}return l?.data??null}catch(l){console.error(l);let m=new ve(l.response?.status??Ne.INTERNAL_SERVER_ERROR,X(l.response?.data),l.stack);if(this._onError)return await this._onError(m),null;throw m}},"request");this._instance=ki.create({...p,baseURL:e?ee(e):""}),this._onError=r,n&&this._instance.interceptors.request.use(({headers:l,responseType:m,timeout:u,withCredentials:c,...M})=>n({...M,headers:l,responseType:m,timeout:u,withCredentials:c})),i&&this._instance.interceptors.response.use(async({data:l,headers:m,status:u,statusText:c,...M})=>i({...M,data:l,headers:m,status:u,statusText:c}))}static{o(this,"_HttpImplementation")}};var Wt=class extends Yt{static{o(this,"HttpImplementation")}};var Kt=class extends Wt{static{o(this,"HttpImplementation")}};Kt=a([Lt()],Kt);import{XMLParser as $i}from"fast-xml-parser";import Bi from"lodash/isNumber.js";import ho from"lodash/isPlainObject.js";import Yi from"lodash/isString.js";var un=o(async t=>{let r=new $i({attributeNamePrefix:"@_",ignoreAttributes:!1,parseAttributeValue:!1,preserveOrder:!0,textNodeName:"#text",trimValues:!0}).parse(t);return _o(r,t)},"parseXml"),_o=o((t,e)=>({find:o((r,n)=>{let i=dn(t,r,n,!1);return i?_o(i,e):null},"find"),findAll:o((r,n)=>{let i=dn(t,r,n,!0);return Array.isArray(i)?i.map(p=>_o(p,e)):[]},"findAll"),text:o(()=>go(t),"text")}),"getNode"),dn=o((t,e,r,n=!1)=>{let i=r?`${r}:${e}`:e,p=[],l=o(m=>{Array.isArray(m)?m.forEach(u=>l(u)):m&&ho(m)&&Object.keys(m).forEach(u=>{let c=m[u];if(u===i||!r&&u.includes(":")&&u.split(":")[1]===e||u===e)if(n)Array.isArray(c)?p.push(...c):p.push(c);else{p.push(Array.isArray(c)?c[0]:c);return}ho(c)&&l(c)})},"search");return l(t),n?p:p.length>0?p[0]:null},"find"),go=o(t=>{if(Yi(t))return t;if(Bi(t))return t.toString();if(Array.isArray(t)){let e=t.map(go).filter(Boolean);return e.length>0?e.join(""):null}if(t&&ho(t)){let e=t["#text"];if(e)return e;let r=[];return Object.keys(t).forEach(n=>{if(!n.startsWith("@_")){let i=go(t[n]);i&&r.push(i)}}),r.length>0?r.join(""):null}return null},"getText");var tt=class extends ge{static{o(this,"ApiDataLoader")}constructor(e){let r=e.source??e.uri;super({...e,name:e.name??r,source:r})}async fetch(){let{headers:e,method:r="GET",params:n,responseType:i="json",transformer:p,uri:l}=this.params,m=G.get(Kt),c=await(()=>{switch(r){case"GET":return m.get;case"POST":return m.post;default:throw new ce}})()({params:n,request:{headers:e,responseType:i},url:l});switch(i){case"xml":{let M=await un(c);return p(M)??[]}default:return c?p(c):[]}}};var Vt="treasuryRate";import cn from"lodash/isNil.js";import Ro from"lodash/toString.js";var yn=new $e({ResourceImplementation:ke,loaders:[new tt({params:{data:"daily_treasury_yield_curve",field_tdr_date_value_month:new k().format("yyyyMM")},responseType:"xml",transformer:o(async t=>t.findAll("entry").reduce((e,r)=>{let n=r.find("updated")?.text()??void 0,i=r.find("properties","m");if(i){let p=i.find("NEW_DATE","d")?.text();if(p){let l={date:new k(p).date,name:Vt};return n&&(l.lastUpdated=new k(n).date),[...e,yo.reduce((m,{unit:u,value:c})=>{let M=u==="mo"?"MONTH":u==="yr"?"YEAR":null;if(M){let _=`value_${c}${u}`,b=`BC_${c}${M}`,P=i.find(b,"d")?.text(),g=P&&parseFloat(P);return cn(g)?m:{...m,[_]:g}}return m},l)]}return e}return e},[]),"transformer"),uri:"https://home.treasury.gov/resource-center/data-chart-center/interest-rates/pages/xmlview"}),new tt({params:{apiKey:process.env.SERVER_POLYGON_API_KEY,limit:1,sort:"date.desc"},transformer:o(async t=>t.results.map(e=>yo.reduce((r,{unit:n,value:i})=>{let p=n==="mo"?"month":n==="yr"?"year":null;if(p){let l=e[`yield_${i}_${p}`],m=`value_${i}${n}`;return cn(l)?r:{...r,[m]:l}}return r},{date:new k(e.date,{format:"yyyy-MM-dd"}).date,name:Vt})),"transformer"),uri:"https://api.polygon.io/fed/v1/treasury-yields"}),new Be({lastUpdatedSelector:o(t=>t.find({type:"class",value:"dates"}),"lastUpdatedSelector"),tableSelector:{type:"id",value:"h15table"},transformer:o(({data:t,headers:e,lastUpdated:r})=>{let n=r?new k(r.replace("Release date: ",""),{format:"MMMM d, yyyy"}).date:void 0,i=[],p=t.findIndex(m=>Ro(m[e[0]]).includes("Nominal")),l=t.findIndex(m=>Ro(m[e[0]]).includes("Inflation indexed"));if(p!==-1&&l!==-1){let m=t.slice(p+1,l),u=e.at(-1);if(u){let{date:c}=new k(u,{format:"yyyy MMM d"}),M={date:c,lastUpdated:n,name:Vt};m.forEach(_=>{let b=Ro(_[e[0]]),P=_[u],[g,z]=b.split("-"),W=(()=>{switch(z){case"month":return"mo";case"year":return"yr";default:return null}})();W&&(M[`value_${g}${W}`]=P),i.push(M)})}}return i},"transformer"),uri:"https://www.federalreserve.gov/releases/h15/"})]});await Yr({loaders:[yn,mn]});
